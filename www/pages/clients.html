{{#response}}
<div class="row">
    <div class="col-12 col-md-8 offset-md-2 mb-3">
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                Totales
                <span class="loading"><i class="fas fa-spin fa-spinner"></i></span>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="col-form-label font-weight-bold">Cartera</label>
                        <input readonly class="form-control" type="text" id="txtTotalCartera">
                    </div>
                    <div class="col-md-4">
                        <label class="col-form-label font-weight-bold">Clientes</label>
                        <input readonly class="form-control" type="text" id="txtTotalClientes">
                    </div>
                    <div class="col-md-4">
                        <label class="col-form-label font-weight-bold">Diferencia</label>
                        <input readonly class="form-control" type="text" id="txtTotalDiferencia">
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table" id="tableCoins">
                        <thead>
                        <tr>
                            <th>Moneda</th>
                            <th>Cartera</th>
                            <th>Clientes</th>
                            <th>Diferencia</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12 col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                Clientes
                <span class="loading"><i class="fas fa-spin fa-spinner"></i></span>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table" id="tableClients">
                        <thead>
                        <tr>
                            <th class="all">Nombre</th>
                            <th>Costo</th>
                            <th class="all">Total</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="assets/dist/js/clients.js"></script>
{{/response}}
{{^response}}
<div class="w-100" style="text-align: center">
    <i class="fa fa-spin fa-spinner fa-3x"></i>
</div>
<script>
    Project.Users.fetchClients().done(({status, code, response: {message, data: {clients, wallet}}, error}) => {
        Project.navigate('clients', {response: {clients, wallet}}).done(() => {
            const $table = $("#tableClients");
            $table.find('tbody').html('');
            const totales = {
                cartera: wallet.total,
                clientes: 0,
                monedas: {cartera: wallet.monedas, clientes: {}}
            };
            $.each(clients, function (key, client) {
                $.each(client.monedas, function (idMoneda, moneda) {
                    const cantidad = (totales.monedas.clientes[idMoneda] || 0) + Number(moneda);
                    totales.monedas.clientes[idMoneda] = Math.round(cantidad * 100000000) / 100000000;
                });
                totales.clientes += +client.total;
                client.costo = numeral(client.costo).format('$0,0.00');
                client.total = numeral(client.total).format('$0,0.00');
                $table.find('tbody').append(`
<tr>
    <td>${client.nombre}</td>
    <td>${client.costo}</td>
    <td>${client.total}</td>
</tr>
                    `);
            });
            console.log(totales.monedas.clientes);
            $.each(totales.monedas.clientes, function (moneda, cantidad) {
                const diferencia = Math.round((totales.monedas.cartera[moneda] - cantidad) * 100000000) / 100000000;
                $("#tableCoins").find('tbody').append(`
<tr>
    <td>${moneda}</td>
    <td>${totales.monedas.cartera[moneda]}</td>
    <td>${cantidad}</td>
    <td>${diferencia}</td>
</tr>
                    `);
            });
            $("#txtTotalCartera").val(numeral(totales.cartera).format('$0,0.00'));
            $("#txtTotalClientes").val(numeral(totales.clientes).format('$0,0.00'));
            $("#txtTotalDiferencia").val(numeral(totales.cartera - totales.clientes).format('$0,0.00'));
        });
    });
</script>
{{/response}}

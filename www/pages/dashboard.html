{{^response}}
    <div class="row">
        <div class="col-12 col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header d-flex justify-content-between">
                    Totales
                    <span class="loading"><i class="fas fa-spin fa-spinner"></i></span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label class="col-form-label font-weight-bold">Costo</label>
                            <input readonly class="form-control" type="text" id="txtTotalCosto">
                        </div>
                        <div class="col-md-4">
                            <label class="col-form-label font-weight-bold">Actual</label>
                            <input readonly class="form-control" type="text" id="txtTotalActual">
                        </div>
                        <div class="col-md-4">
                            <label class="col-form-label font-weight-bold">G/P</label>
                            <input readonly class="form-control" type="text" id="txtTotalGP">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12 col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header d-flex justify-content-between">
                    Monedas
                    <span class="loading"><i class="fas fa-spin fa-spinner"></i></span>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table" id="tableCoins">
                            <thead>
                            <th>Moneda</th>
                            <th>Cantidad</th>
                            <th>Precio</th>
                            <th>Promedio</th>
                            <th>Costo</th>
                            <th>Actual</th>
                            <th>%</th>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(function () {
            $("body > header").css('display', 'flex');
            cantidades();
            Project.refreshInterval = setInterval(cantidades, 60000);
        });

        async function cantidades() {
            const $loading = $(".loading");
            $loading.show();
            const totales = {
                costo: 0,
                actual: 0
            };
            const amounts = await Project.Users.fetchAmounts();
            $("#tableCoins").find('tbody').html('');
            amounts.sort(function(a, b) {
                return b['porcentaje'] - a['porcentaje'];
            });
            $.each(amounts, function (key, coin) {
                totales.costo += coin.costo * 1;
                totales.actual += coin.total;

                coin.costo = numeral(coin.costo).format('$0,0.00');
                coin.precio = numeral(coin.precio).format('$0,0.00');
                coin.promedio = numeral(coin.promedio).format('$0,0.00');
                coin.total = numeral(coin.total).format('$0,0.00');
                coin.porcentaje = numeral(coin.porcentaje).format('0,0.00%');
                coin.cantidad = numeral(coin.cantidad).format('0.00000000');
                $("#tableCoins").find('tbody').append(`
<tr>
    <td>${coin.moneda}</td>
    <td>${coin.cantidad}</td>
    <td>${coin.precio}</td>
    <td>${coin.promedio}</td>
    <td>${coin.costo}</td>
    <td>${coin.total}</td>
    <td>${coin.porcentaje}</td>
</tr>
               `);
            });
            $("#txtTotalCosto").val(numeral(totales.costo).format('$0,0.00'));
            $("#txtTotalActual").val(numeral(totales.actual).format('$0,0.00'));
            $("#txtTotalGP").val(numeral(totales.actual - totales.costo).format('$0,0.00'));

            console.log('finish: ' + Date().toString());
            $loading.hide();
        }
    </script>
{{/response}}
{{#response}}
    {{#user}}
        <script>
            const user = {
                id: '{{id}}',
                nombre: '{{nombre}}',
                correo: '{{correo}}',
                perfil: '{{perfil}}'
            };
            localStorage.setItem('user', JSON.stringify(user));
            Project.navigate('dashboard');
        </script>
    {{/user}}
{{/response}}